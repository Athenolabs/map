# -*- coding: utf-8 -*-
# Copyright (c) 2015, New Indictrans Technologies Pvt Ltd and contributors
# For license information, please see license.txt

from __future__ import unicode_literals
import frappe
from frappe.model.document import Document
import requests,json
from frappe.utils import cstr

class LocateAddressOnMap(Document):
	pass

@frappe.whitelist()
def get_latlon(address_form):
	"""
	Get employee id and return points according to his attendance assumed the working days are 365 and points are 100
	"""
	res=frappe.db.sql("select ifnull(address_line1,''),ifnull(address_line2,''),ifnull(city,''),ifnull(state,''),ifnull(pincode,''),ifnull(country,'') from tabAddress where name='%s' and pincode is not null" %address_form)
	ret={}
	if res:
		code=get_country(res[0][5])
		addr=(' , '.join(res[0])).replace(',  ,',' , ')
		r = requests.get("http://api.geonames.org/postalCodeSearchJSON?postalcode=%s&maxRows=1&country=%s&username=gangadhar_kadam"%(res[0][4],code))
		jsn=json.loads(r.text)
		if jsn['postalCodes']:
			ret={
			"lat":jsn['postalCodes'][0]['lat'],
			"lng":jsn['postalCodes'][0]['lng'],
			"address":addr
			}
		else:
			ret={
			"lat":'',
			"lng":'',
			"address":addr
			}
	return ret

def get_country(country):
	country_json="""{
	"Afghanistan":"AF",
	"Albania":"AL",
	"Algeria":"DZ",
	"American_Samoa":"AS",
	"Andorra":"AD",
	"Angola":"AO",
	"Anguilla":"AI",
	"Antigua_and_Barbuda":"AG",
	"Argentina":"AR",
	"Armenia":"AM",
	"Aruba":"AW",
	"Australia":"AU",
	"Austria":"AT",
	"Azerbaijan":"AZ",
	"Bahamas,_The":"BS",
	"Bahrain":"BH",
	"Bangladesh":"BD",
	"Barbados":"BB",
	"Belarus":"BY",
	"Belgium":"BE",
	"Belize":"BZ",
	"Benin":"BJ",
	"Bermuda":"BM",
	"Bhutan":"BT",
	"Bolivia":"BO",
	"Bosnia_and_Herzegovina":"BA",
	"Botswana":"BW",
	"Bouvet_Island":"BV",
	"Brazil":"BR",
	"British_Indian_Ocean_Territory":"IO",
	"British_Virgin_Islands":"VG",
	"Brunei":"BN",
	"Bulgaria":"BG",
	"Burkina_Faso":"BF",
	"Burma_/_Myanmar":"MM",
	"Burundi":"BI",
	"Cambodia":"KH",
	"Cameroon":"CM",
	"Canada":"CA",
	"Cape_Verde":"CV",
	"Cayman_Islands":"KY",
	"Central_African_Republic":"CF",
	"Chad":"TD",
	"Chile":"CL",
	"China":"CN",
	"Christmas_Island":"CX",
	"Cocos_(Keeling)_Islands":"CC",
	"Colombia":"CO",
	"Comoros":"KM",
	"Congo,_Democratic_Republic_of_the":"ZR",
	"Congo,_Republic_of_the":"CG",
	"Cook_Islands":"CK",
	"Costa_Rica":"CR",
	"Cote_d'Ivoire":"CI",
	"Croatia":"HR",
	"Cuba":"CU",
	"Cyprus":"CY",
	"Czech_Republic":"CZ",
	"Denmark":"DK",
	"Djibouti":"DJ",
	"Dominica":"DM",
	"Dominican_Republic":"DO",
	"East_Timor":"TP",
	"Ecuador":"EC",
	"Egypt":"EG",
	"El_Salvador":"SV",
	"Equatorial_Guinea":"GQ",
	"Eritrea":"ER",
	"Estonia":"EE",
	"Ethiopia":"ET",
	"Falkland_Islands_(Islas_Malvinas)":"FK",
	"Faroe_Islands":"FO",
	"Fiji":"FJ",
	"Finland":"FI",
	"France":"FR",
	"France,_Metropolitan":"FX",
	"French_Guiana":"GF",
	"French_Polynesia":"PF",
	"French_Southern_and_Antarctic_Lands":"TF",
	"Gabon":"GA",
	"Gambia,_The":"GM",
	"Gaza_Strip":"-",
	"Georgia":"GE",
	"Germany":"DE",
	"Ghana":"GH",
	"Gibraltar":"GI",
	"Greece":"GR",
	"Greenland":"GL",
	"Grenada":"GD",
	"Guadeloupe":"GP",
	"Guam":"GU",
	"Guatemala":"GT",
	"Guernsey":"-",
	"Guinea":"GN",
	"Guinea-Bissau":"GW",
	"Guyana":"GY",
	"Haiti":"HT",
	"Heard_Island_and_McDonald_Islands":"HM",
	"Holy_See_(Vatican_City)":"VA",
	"Honduras":"HN",
	"Hong_Kong":"HK",
	"Hungary":"HU",
	"Iceland":"IS",
	"India":"IN",
	"Indonesia":"ID",
	"Iran":"IR",
	"Iraq":"IQ",
	"Ireland":"IE",
	"Israel":"IL",
	"Italy":"IT",
	"Jamaica":"JM",
	"Japan":"JP",
	"Jersey":"-",
	"Jordan":"JO",
	"Kazakhstan":"KZ",
	"Kenya":"KE",
	"Kiribati":"KI",
	"Korea,_North":"KP",
	"Korea,_South":"KR",
	"Kuwait":"KW",
	"Kyrgyzstan":"KG",
	"Laos":"LA",
	"Latvia":"LV",
	"Lebanon":"LB",
	"Lesotho":"LS",
	"Liberia":"LR",
	"Libya":"LY",
	"Liechtenstein":"LI",
	"Lithuania":"LT",
	"Luxembourg":"LU",
	"Macau":"MO",
	"Macedonia,_The_Republic_of":"MK",
	"Madagascar":"MG",
	"Malawi":"MW",
	"Malaysia":"MY",
	"Maldives":"MV",
	"Mali":"ML",
	"Malta":"MT",
	"Man,_Isle_of":"-",
	"Marshall_Islands":"MH",
	"Martinique":"MQ",
	"Mauritania":"MR",
	"Mauritius":"MU",
	"Mayotte":"YT",
	"Mexico":"MX",
	"Micronesia,_Federated_States_of":"FM",
	"Moldova":"MD",
	"Monaco":"MC",
	"Mongolia":"MN",
	"Montserrat":"MS",
	"Morocco":"MA",
	"Mozambique":"MZ",
	"Namibia":"NA",
	"Nauru":"NR",
	"Nepal":"NP",
	"Netherlands":"NL",
	"Netherlands_Antilles":"AN",
	"New_Caledonia":"NC",
	"New_Zealand":"NZ",
	"Nicaragua":"NI",
	"Niger":"NE",
	"Nigeria":"NG",
	"Niue":"NU",
	"Norfolk_Island":"NF",
	"Northern_Mariana_Islands":"MP",
	"Norway":"NO",
	"Oman":"OM",
	"Pakistan":"PK",
	"Palau":"PW",
	"Panama":"PA",
	"Papua_New_Guinea":"PG",
	"Paraguay":"PY",
	"Peru":"PE",
	"Philippines":"PH",
	"Pitcairn_Islands":"PN",
	"Poland":"PL",
	"Portugal":"PT",
	"Puerto_Rico":"PR",
	"Qatar":"QA",
	"Reunion":"RE",
	"Romania":"RO",
	"Russia":"RU",
	"Rwanda":"RW",
	"Saint_Helena":"SH",
	"Saint_Kitts_and_Nevis":"KN",
	"Saint_Lucia":"LC",
	"Saint_Pierre_and_Miquelon":"PM",
	"Saint_Vincent_and_the_Grenadines":"VC",
	"Samoa":"WS",
	"San_Marino":"SM",
	"Sao_Tome_and_Principe":"ST",
	"Saudi_Arabia":"SA",
	"Senegal":"SN",
	"Seychelles":"SC",
	"Sierra_Leone":"SL",
	"Singapore":"SG",
	"Slovakia":"SK",
	"Slovenia":"SI",
	"Solomon_Islands":"SB",
	"Somalia":"SO",
	"South_Africa":"ZA",
	"South_Georgia_and_the_Islands":"GS",
	"Spain":"ES",
	"Sri_Lanka":"LK",
	"Sudan":"SD",
	"Suriname":"SR",
	"Svalbard":"SJ",
	"Swaziland":"SZ",
	"Sweden":"SE",
	"Switzerland":"CH",
	"Syria":"SY",
	"Taiwan":"TW",
	"Tajikistan":"TJ",
	"Tanzania":"TZ",
	"Thailand":"TH",
	"Togo":"TG",
	"Tokelau":"TK",
	"Tonga":"TO",
	"Trinidad_and_Tobago":"TT",
	"Tunisia":"TN",
	"Turkey":"TR",
	"Turkmenistan":"TM",
	"Turks_and_Caicos_Islands":"TC",
	"Tuvalu":"TV",
	"Uganda":"UG",
	"Ukraine":"UA",
	"United_Arab_Emirates":"AE",
	"United_Kingdom":"GB",
	"United_States":"US",
	"United_States_Minor_Outlying_Islands":"UM",
	"Uruguay":"UY",
	"Uzbekistan":"UZ",
	"Vanuatu":"VU",
	"Venezuela":"VE",
	"Vietnam":"VN",
	"Virgin_Islands":"VI",
	"Virgin_Islands_(UK)":"-",
	"Wallis_and_Futuna":"WF",
	"Western_Sahara":"EH",
	"Western_Samoa":"-",
	"Yemen":"YE",
	"Yugoslavia":"YU",
	"Zambia":"ZM",
	"Zimbabwe":"ZW"
	}
	"""
	country_dict=json.loads(country_json)
	return country_dict[country.replace(' ','_')]